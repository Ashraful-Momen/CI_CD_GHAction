Perfect ğŸ”¥ letâ€™s break this **GitHub Actions CD pipeline** **line by line**, Laravel-style.

---

```yaml
name: CD Deploy
```

ğŸ‘‰ Workflow name.
You will see this in **GitHub â†’ Actions tab**.

---

```yaml
on:
  push:
    branches: [ main ]
```

ğŸ‘‰ Trigger rule.

* Whenever you **push to main branch**
* This workflow will **automatically run**

Laravel analogy:

> Like `Event::listen('git.push.main', DeployJob::class);`

---

```yaml
jobs:
  deploy:
```

ğŸ‘‰ Define a job named `deploy`.

You can have multiple jobs (test, build, deploy), but here only **deploy**.

---

```yaml
    runs-on: ubuntu-latest
```

ğŸ‘‰ GitHub creates a **temporary Ubuntu server** to run this job.

---

```yaml
    steps:
```

ğŸ‘‰ Steps are like **commands in a shell script**.

They run **top to bottom**.

---

## STEP 1 â€“ Checkout your code

```yaml
    - uses: actions/checkout@v4
```

ğŸ‘‰ Downloads your GitHub repo into the runner.

Laravel analogy:

> Like `git clone` inside the CI server.

---

## STEP 2 â€“ Setup SSH

```yaml
    - name: Setup SSH
      run: |
```

ğŸ‘‰ A step named **Setup SSH**.
`|` means â€œrun multi-line shell scriptâ€.

---

```bash
mkdir -p ~/.ssh
```

ğŸ‘‰ Create SSH folder if not exists.

---

```bash
echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
```

ğŸ‘‰ Write your **private SSH key** (stored in GitHub secrets) into a file.

`${{ secrets.SSH_PRIVATE_KEY }}`
â†’ comes from GitHub â†’ Settings â†’ Secrets.

---

```bash
chmod 600 ~/.ssh/id_ed25519
```

ğŸ‘‰ Secure the key (SSH refuses weak permissions).

---

```bash
ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
```

ğŸ‘‰ Trust your serverâ€™s SSH fingerprint
(avoids â€œAre you sure you want to connect?â€ error).

---

## STEP 3 â€“ Deploy to Server

```yaml
    - name: Deploy to server
      run: |
```

ğŸ‘‰ Start deployment commands.

---

```bash
ssh ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
```

ğŸ‘‰ SSH into your production server.

Everything until `EOF` will run **on the server**.

---

```bash
cd /var/www/lindos
```

ğŸ‘‰ Go to your project folder.

---

```bash
git pull
```

ğŸ‘‰ Pull the latest code from GitHub.

Laravel analogy:

> Like updating your production source code.

---

```bash
docker stack deploy -c docker-compose.yml lindos
```

ğŸ‘‰ Redeploy Swarm service.

* `-c docker-compose.yml` â†’ config file
* `lindos` â†’ stack name

Swarm will:

* Update containers
* Follow rolling update rules
* Keep site running

---

```bash
EOF
```

ğŸ‘‰ End of remote SSH commands.

---

# ğŸ§  Flow Summary

```
git push main
   â†“
GitHub runner starts
   â†“
Downloads code
   â†“
Creates SSH connection
   â†“
Logs into server
   â†“
git pull
   â†“
docker stack deploy
   â†“
Zero-downtime update ğŸš€
```

---

If you want, next I can:

* Add **build image step**
* Add **healthcheck verification**
* Add **Slack / Telegram deploy alert**
* 
